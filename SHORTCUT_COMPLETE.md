# iOS 快捷指令 - 自动记账完整配置

## 更新后的 URL Scheme（支持备注）

```
accounting://add
  ?amount=123.50          （必填）金额
  &merchant=商家名称       （必填）商家/交易对象
  &category=分类          （可选）默认自动分类
  &time=2024-01-15T14:30  （可选）默认当前时间
  &note=备注内容          （可选）如：午餐、打车回家
  &source=wechat/alipay   （可选）数据来源
```

---

## 方案一：微信专用（推荐）

### 微信通知示例：
```
微信支付
支付成功¥35.00
星巴克咖啡
```

### 快捷指令配置：

**触发：** 收到通知时 → 选择「微信」

**操作 1：获取通知内容**
- 添加「获取当前通知的详细信息」
- 选择「内容」

**操作 2：提取金额**
- 添加「匹配文本」
- 模式：`¥([0-9]+?\.[0-9]*)`
- 获取「第一个匹配」→ 存入变量「金额」

**操作 3：提取商家（第三行）**
- 添加「拆分文本」
- 输入：通知内容
- 分隔符：换行符
- 获取「项目 3」→ 存入变量「商家」

**操作 4：提取备注（可选）**
- 如果通知内容包含「付款给」
  - 匹配文本：`付款给(.+?)(：|，|\n)`
  - 存入变量「备注」

**操作 5：打开记账 App**
- 添加「打开 URL」
- URL：
```
accounting://add?amount=[金额]&merchant=[商家]&note=[备注]&source=wechat
```

---

## 方案二：支付宝专用

### 支付宝通知示例：
```
支付宝
你有一笔支出
付款金额：35.00元
付款方式：余额
交易对象：星巴克
```

### 快捷指令配置：

**操作 1：提取金额**
- 匹配文本：`付款金额：([0-9]+?\.[0-9]*)元`
- 存入变量「金额」

**操作 2：提取商家**
- 匹配文本：`交易对象：(.+?)$`
- 存入变量「商家」

**操作 3：打开记账 App**
```
accounting://add?amount=[金额]&merchant=[商家]&source=alipay
```

---

## 方案三：通用版（简单）

如果正则提取太复杂，可以先只提取金额：

```
收到通知时（微信/支付宝）
├── 获取通知内容
├── 匹配金额：¥([0-9]+?\.[0-9]*)
└── 打开 URL：
    accounting://add?amount=[金额]&merchant=快捷支付&source=shortcut
```

然后在 App 内编辑补充商家和备注。

---

## 智能分类说明

**不需要在快捷指令里写分类规则！**

App 会自动处理：
1. **商家学习** → 如果之前给「星巴克」选过「餐饮」，下次自动用「餐饮」
2. **智能分类** → 根据关键词自动匹配（如「滴滴」→「交通」）
3. **默认分类** → 以上都匹配不到时，用「其他」

**分类关键词：**
- 餐饮：麦当劳、肯德基、星巴克、火锅、烧烤、奶茶、咖啡、餐厅、外卖
- 交通：滴滴、高德、地铁、公交、加油、停车、高速
- 购物：淘宝、京东、拼多多、超市、便利店
- 娱乐：影院、KTV、游戏、视频会员
- 医疗：医院、药店、诊所
- 住房：房租、水电、燃气、宽带
- 教育：学费、培训、书籍

---

## 手动测试 URL

在 Safari 地址栏输入测试：

**基础版：**
```
accounting://add?amount=35.00&merchant=星巴克&source=test
```

**完整版（带备注）：**
```
accounting://add?amount=99.99&merchant=海底捞&note=聚餐&category=餐饮&time=2024-02-26T19:30:00&source=test
```

---

## 调试技巧

### 1. 查看通知原文
在快捷指令中添加：
- 「显示通知」→ 显示「通知内容」变量
- 这样可以看到微信/支付宝实际发送了什么

### 2. 分步测试
- 先测试能否提取金额
- 再测试能否提取商家
- 最后测试打开 URL

### 3. 常见问题

**Q: 提取不到金额？**
- 微信可能是「¥35.00」或「35.00元」
- 尝试两种正则：`¥([0-9]+?\.[0-9]*)` 或 `([0-9]+?\.[0-9]*)元`

**Q: 商家提取不对？**
- 微信通知格式可能变化
- 用「拆分文本」按行提取，比正则更稳定

**Q: App 没反应？**
- 确认 URL Scheme 是 `accounting://`
- 确认 App 已安装
- 首次运行需要在快捷指令中授权

---

## 快捷指令示例截图（文字版）

```
┌─────────────────────────────┐
│  自动化：收到微信通知时        │
├─────────────────────────────┤
│  1. 获取当前通知的详细信息    │
│     └── 内容                 │
├─────────────────────────────┤
│  2. 匹配文本                 │
│     └── 模式：¥([0-9]+\.?[0-9]*)│
│     └── 获取第一个匹配        │
│     └── 设为变量：金额        │
├─────────────────────────────┤
│  3. 拆分文本                 │
│     └── 输入：通知内容        │
│     └── 分隔符：换行          │
│     └── 获取项目 3           │
│     └── 设为变量：商家        │
├─────────────────────────────┤
│  4. 打开 URL                 │
│     └── accounting://add?    │
│         amount=[金额]        │
│         &merchant=[商家]     │
│         &source=wechat       │
└─────────────────────────────┘
```
