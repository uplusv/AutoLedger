# iOS 快捷指令 - 自动记账完整配置

## 方案一：简单版（推荐先测试这个）

### 快捷指令步骤：

```
1. 收到通知时（选择微信或支付宝）
   └── 获取通知内容
       └── 匹配文本：¥([0-9]+\.?[0-9]*)
           └── 获取匹配结果（金额）
               └── 打开 URL：
                   accounting://add?amount=[匹配结果]&merchant=微信支付&category=其他&source=wechat
```

### 具体设置：

**触发条件：**
- 自动化 → 收到通知时
- 选择 App：微信

**操作 1：获取通知内容**
- 搜索「获取当前通知的详细信息」
- 选择「内容」

**操作 2：提取金额**
- 搜索「匹配文本」
- 输入模式：`¥([0-9]+\.?[0-9]*)`
- 或：`([0-9]+\.?[0-9]*)元`

**操作 3：打开 App**
- 搜索「打开 URL」
- URL：
```
accounting://add?amount=[匹配文本]&merchant=微信支付&category=餐饮&time=[当前日期]
```

---

## 方案二：完整版（提取商家+金额）

微信通知示例：
```
微信支付
支付成功¥35.00
星巴克咖啡
```

### 快捷指令步骤：

```
收到通知时（微信）
├── 获取通知内容
├── 提取金额：匹配 ¥([0-9]+\.?[0-9]*)
├── 提取商家：匹配 [\n](.+?)[\n]  （第三行）
└── 打开 URL：
    accounting://add?amount=[金额]&merchant=[商家]&category=[自动分类]&time=[日期]
```

### 自动分类规则（快捷指令内设置）：

用「如果」条件判断商家关键词：

```
如果 [商家] 包含 "麦当劳" 或 "肯德基" 或 "星巴克"
    分类 = "餐饮"
否则如果 [商家] 包含 "滴滴" 或 "地铁" 或 "公交"
    分类 = "交通"
否则如果 [商家] 包含 "淘宝" 或 "京东" 或 "拼多多"
    分类 = "购物"
否则
    分类 = "其他"
```

---

## 方案三：支付宝专用

支付宝通知示例：
```
支付宝
你有一笔支出
付款金额：35.00元
付款方式：余额
交易对象：星巴克
```

### 提取正则：

**金额：** `付款金额：([0-9]+\.?[0-9]*)元`

**商家：** `交易对象：(.+?)$`

---

## 手动测试 URL

在 Safari 地址栏输入：

```
accounting://add?amount=99.99&merchant=测试商家&category=餐饮&time=2024-02-26T20:00:00
```

如果 App 能打开并显示记账成功，说明 URL Scheme 配置正确。

---

## 常见问题

### Q1: 快捷指令不自动运行？
- iOS 17+ 需要关闭「运行前询问」
- 首次需要在快捷指令中授权

### Q2: 提取不到金额？
- 微信/支付宝通知格式可能更新
- 在快捷指令中添加「显示结果」调试，看通知原文

### Q3: App 打不开？
- 确认已安装记账 App
- 确认 URL Scheme 已注册（accounting://）
- 重启 App 再试

### Q4: 如何调试？
在快捷指令中添加：
- 「显示通知」显示提取的金额和商家
- 「快速查看」显示完整的通知内容

---

## 完整 URL Scheme 参数

```
accounting://add
  ?amount=123.50          （必填）金额
  &merchant=商家名称       （必填）商家
  &category=分类          （可选）默认"其他"
  &time=2024-01-15T14:30  （可选）默认当前时间
  &note=备注              （可选）
  &source=wechat/alipay   （可选）数据来源
```
